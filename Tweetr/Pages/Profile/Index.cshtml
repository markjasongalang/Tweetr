@page
@model Tweetr.Pages.Profile.IndexModel
@{
    ViewData["Title"] = "My Profile";
}

<style>
    .upper {
        width: inherit;
        height: auto;
        padding-bottom: 20px;
        border-bottom: 1px solid #D9D9D9;
    }

    .cover-image {
        width: inherit;
        height: 200px;
    }

    .cover-image img {
        width: inherit;
        height: inherit;
        object-fit: cover;
    }

    .profile-image {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        border: 4px solid white;
        margin-left: 30px;
        margin-top: -70px;
    }
</style>

<!-- Edit Profile Modal -->
<div class="modal fade" id="edit-profile-modal" tabindex="-1">
    <div class="modal-dialog">

        <!-- Start of Form -->
        <form asp-page-handler="EditProfile" method="post" enctype="multipart/form-data" asp-route-username="@Model.User.Username">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h1 class="modal-title fs-5">Edit profile</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal Body -->
                <div class="modal-body">
                    <!-- Cover Image -->
                    <div class="mb-3">
                        <label class="form-label">Cover Image</label>
                        <input type="file" accept=".jpeg, .jpg, .png" asp-for="CoverImageUpload" value="Choose image" class="form-control" />
                        <span class="text-danger" asp-validation-for="CoverImageUpload"></span>
                    </div>

                    <!-- Profile Image -->
                    <div class="mb-3">
                        <label class="form-label">Profile Image</label>
                        <input type="file" accept=".jpeg, .jpg, .png" asp-for="ProfileImageUpload" value="Choose image" class="form-control" />
                        <span class="text-danger" asp-validation-for="ProfileImageUpload"></span>
                    </div>

                    <!-- Name -->
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" class="form-control" asp-for="@Model.Name">
                        <span class="text-danger" asp-validation-for="Name"></span>
                    </div>

                    <!-- Bio -->
                    <div class="mb-3">
                        <label class="form-label">Bio</label>
                        <input type="text" class="form-control" asp-for="@Model.Bio">
                        <span class="text-danger" asp-validation-for="Bio"></span>
                    </div>

                    <!-- TODO: Place notification after update -->

                </div>

                <!-- Modal Footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <input type="submit" value="Save" class="btn btn-primary">
                </div>
            </div>
        </form>
        <!-- End of Form -->

    </div>
</div>

<div class="container">
    <div class="upper mb-3">
        <!-- Cover Image -->
        <div class="bg-secondary cover-image">
            @if (!string.IsNullOrEmpty(Model.User.CoverImageUrl))
            {
                <img src="@Model.User.CoverImageUrl" />
            }
        </div>

        <!-- Profile Info -->
        <div class="d-flex justify-content-between">
            <img src="~/@Model.User.ProfileImageUrl" class="profile-image" alt="Profile image" />

            @if (!Model.IsAccount)
            {
                <form class="py-3 px-4" method="post">
                    <input class="btn btn-outline-primary" type="submit" value="Follow" />
                </form>
            }
            else
            {
                <div class="d-flex">
                    <div class="py-3">
                        <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#edit-profile-modal">
                            Edit profile
                        </button>
                    </div>

                    <form class="py-3 ps-3 pe-4" asp-page-handler="logout" method="post">
                        <input class="btn btn-outline-danger" type="submit" value="Logout" />
                    </form>
                </div>
            }
        </div>

        <div class="pt-3 ps-3">
            <h5>@Model.User.Name</h5>
            <p class="text-secondary">&#64;@Model.User.Username</p>

            <!-- TODO: Add bio editing -->
            <p>Bio</p>

            <p class="text-secondary"><i class="bi bi-calendar-week"></i> Joined @Html.DisplayFor(model => model.User.DateJoined)</p>

            <!-- TODO: Refer to 'Follow' table -->
            <p>
                <strong>0</strong> <span class="text-secondary">Following</span>
                &nbsp;&nbsp;
                <strong>0</strong> <span class="text-secondary">Followers</span>
            </p>
        </div>

    </div>

    @foreach (var item in Model.Posts)
    {
        <a style="color: inherit; text-decoration: none;" asp-page="/Posts/Details" asp-route-id="@item.Id">
            <div class="card mb-3">
                <div class="card-body">
                    <p>
                        <strong>@Html.DisplayFor(modelItem => item.Name)</strong> <span class="text-secondary">&#64;@Html.DisplayFor(modelItem => item.Username) &#183; @Html.DisplayFor(modelItem => item.DatePosted)</span>
                    </p>

                    <p style="white-space: pre-line;">@Html.DisplayFor(modelItem => item.Content)</p>

                    <p>
                        <i class="bi bi-heart"></i>@item.TotalLikes&nbsp;
                        <i class="bi bi-chat"></i>@item.TotalComments&nbsp;
                        <i class="bi bi-send"></i>@item.TotalReposts
                    </p>
                </div>
            </div>
        </a>
    }
</div>

<script>

</script>

@section Scripts
{
    @{ await Html.RenderPartialAsync("_ValidationScriptsPartial"); }
}